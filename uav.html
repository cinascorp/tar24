<!DOCTYPE html>
<html>
<head>
	<title>UAV Tracker</title>
	<style>
		html, body { height:100%; margin:0; padding:0; }
		#map { height:100%; width:100%; }
		.info-window { font-family: Arial, sans-serif; padding:10px; max-width:320px; }
	</style>
</head>
<body>
	<div id="map"></div>
	<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA6myHzS10YXdcazAFalmXvDkrYCp5cLc8&v=beta&libraries=marker"></script>
	<script>
	(function(){
		let map; let markers=[];
		const droneSvg = {
			path: 'M12 10a2 2 0 100 4 2 2 0 000-4zm-7-2l3 1 2-1 1 2-1 2-2-1-3 1 1-3-1-2zm14 0l-3 1-2-1-1 2 1 2 2-1 3 1-1-3 1-2zM5 17l3-1 2 1 1-2-1-2-2 1-3-1 1 3-1 2zm14 0l-3-1-2 1-1-2 1-2 2 1 3-1-1 3 1 2z',
			fillColor: '#ffffff', fillOpacity: 1, strokeWeight: 0, scale: 1
		};
		function isDrone(aircraftType, speed, altitude){
			const type = (aircraftType||'').toUpperCase();
			const slow = Number(speed||0) <= 120; const low = Number(altitude||0) <= 4000;
			return type.includes('DRON') || type.includes('UAV') || type.includes('QUAD') || (slow && low);
		}
		async function fetchFlightData(){
			try{
				const response=await fetch('https://data-cloud.flightradar24.com/zones/fcgi/zone.js?adsb=1&mlat=1&flarm=1&estimated=1&air=1&gnd=1&vehicles=1&gliders=1');
				const text=await response.text();
				const jsonStart=text.indexOf('{');
				return JSON.parse(text.substring(jsonStart));
			}catch(e){ console.error('fetch error', e); return {}; }
		}
		function addAdvancedMarker(position, title){
			const pin = new google.maps.marker.PinElement({background:'#d21674', glyph:'U', borderColor:'#000'});
			const marker = new google.maps.marker.AdvancedMarkerElement({map, position, title, content: pin.element});
			return marker;
		}
		function addStandardMarker(position, iconUrl, rotation, title){
			return new google.maps.Marker({position, map, icon:{url:iconUrl, scaledSize:new google.maps.Size(32,32), anchor:new google.maps.Point(16,16), rotation}, title});
		}
		async function updateFlights(){
			const data=await fetchFlightData(); markers.forEach(m=>m.map&&m.map(null)); markers=[];
			for(const key in data){ if(key==='full_count'||key==='version') continue; const arr=data[key]; if(!Array.isArray(arr)||arr.length<19) continue;
				const [icao, lat, lng, heading, altitude, speed, squawk, radar, aircraftType, registration, timestamp, origin, destination, flightNumber, isGround, verticalSpeed, callsign, unknown, airline] = arr;
				if(!lat||!lng||isNaN(lat)||isNaN(lng)) continue;
				const position={lat:parseFloat(lat), lng:parseFloat(lng)};
				const title=callsign||flightNumber||registration||'Unknown';
				let marker;
				if(isDrone(aircraftType, speed, altitude)){
					marker = addAdvancedMarker(position, title);
				} else {
					marker = addStandardMarker(position, 'https://img.icons8.com/external-icongeek26-glyph-icongeek26/64/external-airplane-transportation-icongeek26-glyph-icongeek26-6.png', parseInt(heading)||0, title);
				}
				const info = new google.maps.InfoWindow({
					content:`<div class="info-window">
						<h3>${title}</h3>
						<p>ICAO: ${icao||'N/A'}</p>
						<p>Lat: ${lat||'N/A'}, Lng: ${lng||'N/A'}</p>
						<p>Heading: ${heading||'N/A'}°</p>
						<p>Altitude: ${altitude? altitude+' ft':'N/A'}</p>
						<p>Speed: ${speed? speed+' kts':'N/A'}</p>
						<p>Type: ${aircraftType||'N/A'} | Reg: ${registration||'N/A'}</p>
						<p>From: ${origin||'N/A'} ➜ To: ${destination||'N/A'}</p>
						<p>Flight: ${flightNumber||'N/A'} | Callsign: ${callsign||'N/A'}</p>
						<p>Vertical: ${verticalSpeed||'N/A'} ft/min | On Ground: ${isGround? 'Yes':'No'}</p>
						<p>Airline: ${airline||'N/A'}</p>
						<p><a href="https://www.jetphotos.com/registration/${encodeURIComponent(registration||'')}" target="_blank" rel="noopener">Photos</a></p>
					</div>`
				});
				marker.addListener('click', ()=> info.open({map, anchor: marker}));
				markers.push(marker);
			}
			setTimeout(updateFlights, 10000);
		}
		function init(){ map=new google.maps.Map(document.getElementById('map'), {center:{lat:35.693, lng:51.330}, zoom:6, mapId: '4504f8b37365c3d0'}); updateFlights(); }
		window.addEventListener('load', init);
	})();
	</script>
</body>
</html>